#!/usr/bin/env bash

cecho() { echo "$(tput setaf ${ci:-1})$1$(tput sgr0)" && ci=$(( (${ci:-1} % 6) + 1 )); }

cecho "Installing homebrew..."
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

pkgs="zsh git tmux exa vim sed grep ranger fzf fd bat ripgrep vim"
for pkg in $pkgs; do
    cecho "Installing $pkg..."
    brew install $pkg
done

cecho "Setting up fzf..."
$(brew --prefix)/opt/fzf/install

cecho "Installing Oh My Zsh..."
sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)" "" --unattended

cecho "Installing Oh My Zsh plugins: fast-syntax-highlighting, zsh-autosuggestions, zsh-nvm..."
git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
git clone https://github.com/zdharma/fast-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/fast-syntax-highlighting
git clone https://github.com/lukechilds/zsh-nvm ~/.oh-my-zsh/custom/plugins/zsh-nvm

cecho "Installing tmux plugin manager..."
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

cecho "Installing tmux-256color terminfo"
curl -LO http://invisible-island.net/datafiles/current/terminfo.src.gz
gunzip terminfo.src.gz
tic -x terminfo.src
rm terminfo.src

cecho "Installing pyenv..."
curl https://pyenv.run | bash

cecho "Symlinking to new dotfiles..."
ln -isv ~/.dotfiles/tmux.conf ~/.tmux.conf
ln -isv ~/.dotfiles/zshrc ~/.zshrc
mkdir -pv ~/.config/nvim && ln -isv ~/.dotfiles/init.vim ~/.config/nvim/init.vim
mkdir -pv ~/.jupyter/custom && ln -isv ~/.dotfiles/jupyter-custom.js ~/.jupyter/custom/custom.js
mkdir -pv ~/.ptpython && ln -isv ~/.dotfiles/ptpython-config.py ~/.ptpython/config.py

cecho "Changing login shell..."
chsh -s $(which zsh)

cecho "$(tput bold)Installation complete. Starting zsh..."
exec zsh
