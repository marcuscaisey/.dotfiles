# Allow all terminal colours
set -g default-terminal "tmux-256color"
# Tell tmux that outside terminal supports true color
set -ga terminal-overrides ",xterm-256color*:Tc"

# Allow escape sequence passthrough, needed to use OSC52 for yanking to clipboard
set -g allow-passthrough on

# Set clipboard using OSC52
set -g set-clipboard on

# Use vi keybindings in copy mode
set-window-option -g mode-keys vi
# Start copy mode visual selection with v
bind -T copy-mode-vi v send -X begin-selection
# Yank copy mode visual selection with y
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel
# Use the prefix_g keytable with g in copy mode, this allows for keybindings of
# multiple keys which start with g
bind-key -T copy-mode-vi g switch-client -T prefix_g
# Go to start of line in copy mode with gh
bind-key -T prefix_g h send-keys -X back-to-indentation
# Go to end of line in copy mode with gl
bind-key -T prefix_g l send-keys -X end-of-line
# Go to top in copy mode with gk
bind-key -T prefix_g k send-keys -X history-top
# Go to bottom in copy mode with gj
bind-key -T prefix_g j send-keys -X history-bottom
# Paste with <prefix> + P
bind P paste-buffer

# Remap <prefix> to C-a
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Start window numbering at 1
set -g base-index 1

# Automatically renumber windows on deletion / addition
set-option -g renumber-windows on

# Split panes vertically and horizontally with <prefix> + \ and <prefix> + -
# and open in same directory
bind '\' split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Send pane to another window with <prefix> + S
bind-key S command-prompt -p "send pane to window:" "join-pane -t :%%"

# Display panes for 5s
set -g display-panes-time 5000

# Swap current pane with another with <prefix> + s
bind-key s display-pane "swap-pane -d -t %%"

# Open new window in same directory
bind c new-window -c "#{pane_current_path}"

# Enable mouse mode
set -g mouse on

# Disable auto window renaming by programs
set -g allow-rename off

# Automatically rename window to $path:$command
set-option -g status-interval 5
set-option -g automatic-rename-format '#{b:pane_current_path}:#{pane_current_command}'
# Reset renamed window name to $path:$command with <prefix> + r
bind r set-window-option automatic-rename on

# Resize the pane with alt + h/j/k/l
bind -n M-k resize-pane -U 1
bind -n M-j resize-pane -D 1
bind -n M-h resize-pane -L 1
bind -n M-l resize-pane -R 1

# Switch panes with <prefix> + h/j/k/l
bind h select-pane -L
bind l select-pane -R
bind k select-pane -U
bind j select-pane -D

# Swap window left / right with <prefix> + < / >
bind-key -r < swap-window -t -1 -d
bind-key -r > swap-window -t +1 -d

# Reload tmux.conf with <prefix> + r
bind R source-file ~/.tmux.conf

# Wait only for 10ms for escape to be registered
set -sg escape-time 10

# Theme
thm_bg="#1e1e2e"
thm_fg="#cdd6f4"
thm_cyan="#89dceb"
thm_gray="#313244"
thm_pink="#f5c2e7"
thm_green="#a6e3a1"
thm_blue="#89b4fa"
thm_orange="#fab387"

set-option -g status "on"
set-option -g status-bg "${thm_bg}"
set-option -g status-justify "left"
set-option -g status-left ""
set-option -g status-right "#[fg=$thm_bg,bg=$thm_green]  #[fg=$thm_fg,bg=$thm_gray] #{session_name} #[fg=$thm_bg,bg=$thm_pink]  #[fg=$thm_fg,bg=$thm_gray] %H:%M | %Y-%m-%d "
set-option -g status-left-length "100"
set-option -g status-right-length "100"
set-option -g message-style "fg=${thm_cyan},bg=${thm_gray},align=centre"
set-option -g message-command-style "fg=${thm_cyan},bg=${thm_gray},align=centre"
set-option -g pane-border-style "fg=${thm_gray}"
set-option -g pane-active-border-style "fg=${thm_green}"
set-window-option -g window-status-activity-style "fg=${thm_fg},bg=${thm_bg},none"
set-window-option -g window-status-separator ""
set-window-option -g window-status-style "fg=${thm_fg},bg=${thm_bg},none"
set-window-option -g window-status-format "#[fg=$thm_bg,bg=$thm_blue] #{window_index} #[fg=$thm_fg,bg=$thm_bg] #{window_name} "
set-window-option -g window-status-current-format "#[fg=$thm_bg,bg=$thm_orange] #{window_index} #[fg=$thm_fg,bg=$thm_gray] #{window_name} "

# Plugins
set -g @plugin 'tmux-plugins/tpm'

set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'artemave/tmux_super_fingers'

set -g @continuum-restore 'on'
set -g @super-fingers-key f

run -b '~/.tmux/plugins/tpm/tpm'
